<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø°ÙƒÙŠ - ÙˆØ§Ø¬Ù‡Ø© Ù†Ø¸ÙŠÙØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1b5e20; --gold: #c5a059; --bg: #fdfdfd; --text: #333; }
        body.dark { --bg: #1a1a1a; --text: #e0e0e0; --primary: #2e7d32; }
        body { margin: 0; font-family: 'Amiri', serif; background: var(--bg); color: var(--text); transition: 0.3s; overflow: hidden; }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) */
        header { 
            position: fixed; top: -100px; width: 100%; background: var(--primary); 
            color: white; padding: 10px 0; transition: 0.4s; z-index: 1000;
            display: flex; justify-content: center; align-items: center; gap: 15px;
        }
        header.active { top: 0; }

        .color-bar { display: flex; gap: 8px; background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; }
        .color-dot { width: 25px; height: 25px; border-radius: 50%; cursor: pointer; border: 2px solid white; }
        .c1 { background: #ffeb3b; } .c2 { background: #ff5252; } .c3 { background: #64ffda; } .c4 { background: #e1bee7; } .c5 { background: #ffb74d; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© */
        #quran-container { height: 100vh; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .page-card { width: 90%; max-width: 500px; height: 85%; background: white; border: 4px double var(--gold); border-radius: 15px; padding: 30px; overflow-y: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        body.dark .page-card { background: #252525; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© (ØªØ¸Ù‡Ø± ÙˆØªØ®ØªÙÙŠ) */
        footer { 
            position: fixed; bottom: -100px; width: 100%; background: var(--primary); 
            display: flex; justify-content: space-around; padding: 15px 0; 
            transition: 0.4s; z-index: 1000; border-radius: 20px 20px 0 0;
        }
        footer.active { bottom: 0; }

        .btn { color: white; cursor: pointer; text-align: center; font-size: 14px; }
        .word { display: inline-block; padding: 0 2px; border-radius: 4px; transition: 0.2s; }
        
        .panel { position: fixed; bottom: -100%; left: 0; width: 100%; height: 70%; background: var(--bg); z-index: 2000; transition: 0.5s; border-radius: 25px 25px 0 0; padding: 20px; box-sizing: border-box; }
        .panel.active { bottom: 0; }
    </style>
</head>
<body onclick="toggleMenus(event)">

    <header id="pen-tools">
        <div class="color-bar">
            <div class="color-dot c1" onclick="selectedColor='#ffeb3b'"></div>
            <div class="color-dot c2" onclick="selectedColor='#ff5252'"></div>
            <div class="color-dot c3" onclick="selectedColor='#64ffda'"></div>
            <div class="color-dot c4" onclick="selectedColor='#e1bee7'"></div>
            <div class="color-dot c5" onclick="selectedColor='#ffb74d'"></div>
        </div>
        <div class="btn" onclick="undoLast()">â†© ØªØ±Ø§Ø¬Ø¹</div>
        <div class="btn" onclick="closePen()" style="color:#ff5252">âœ–</div>
    </header>

    <div id="quran-container">
        <div class="page-card" id="content" onclick="event.stopPropagation()">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>

    <footer id="main-footer">
        <div onclick="prevPage()" class="btn">â—€</div>
        <div onclick="togglePen()" class="btn">âœï¸ Ø§Ù„Ù‚Ù„Ù…</div>
        <div onclick="togglePanel('notes-panel')" class="btn">ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
        <div onclick="toggleSearch()" class="btn">ğŸ” Ø¨Ø­Ø«</div>
        <div onclick="toggleDark()" class="btn">ğŸŒ™</div>
        <div onclick="nextPage()" class="btn">â–¶</div>
    </footer>

    <script>
        let currentSura = parseInt(localStorage.getItem('lastSura')) || 0;
        let quranData = [];
        let selectedColor = '#ffeb3b';
        let highlights = JSON.parse(localStorage.getItem('myHighlights')) || [];
        
        async function loadQuran() {
            const res = await fetch('https://api.alquran.cloud/v1/quran/quran-uthmani');
            const data = await res.json();
            quranData = data.data.surahs;
            render();
        }

        // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©
        function toggleMenus(e) {
            document.getElementById('main-footer').classList.toggle('active');
        }

        function togglePen() {
            document.getElementById('pen-tools').classList.add('active');
            document.getElementById('main-footer').classList.remove('active');
        }

        function closePen() {
            document.getElementById('pen-tools').classList.remove('active');
        }

        function render() {
            const sura = quranData[currentSura];
            let html = `<h2 style="text-align:center; color:var(--primary)">${sura.name}</h2>`;
            sura.ayahs.forEach((a, ayIdx) => {
                a.text.split(' ').forEach((word, wIdx) => {
                    const id = `s${currentSura}a${ayIdx}w${wIdx}`;
                    const h = highlights.find(x => x.id === id);
                    html += `<span id="${id}" class="word" ${h ? `style="background:${h.color}"` : ''} onclick="highlightWord('${id}','${word}')">${word}</span> `;
                });
                html += `<span style="color:var(--primary)">(${ayIdx+1})</span> `;
            });
            document.getElementById('content').innerHTML = html;
            localStorage.setItem('lastSura', currentSura);
        }

        function highlightWord(id, text) {
            const el = document.getElementById(id);
            if (el.style.background) {
                el.style.background = '';
                highlights = highlights.filter(h => h.id !== id);
            } else {
                el.style.background = selectedColor;
                highlights.push({ id, text, color: selectedColor });
            }
            localStorage.setItem('myHighlights', JSON.stringify(highlights));
        }

        function undoLast() {
            if (highlights.length > 0) {
                const last = highlights.pop();
                const el = document.getElementById(last.id);
                if (el) el.style.background = '';
                localStorage.setItem('myHighlights', JSON.stringify(highlights));
            }
        }

        function nextPage() { if(currentSura < 113) { currentSura++; render(); } }
        function prevPage() { if(currentSura > 0) { currentSura--; render(); } }
        function toggleDark() { document.body.classList.toggle('dark'); }

        loadQuran();
    </script>
</body>
</html>
