<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÿßŸÑŸÖÿµÿ≠ŸÅ ÿßŸÑÿ∞ŸÉŸä - ÿ™ŸÇŸÑŸäÿ® ÿ£ŸÅŸÇŸä</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1b5e20; --gold: #c5a059; --bg: #fdfdfd; --text: #333; }
        body.dark { --bg: #1a1a1a; --text: #e0e0e0; --primary: #2e7d32; }
        body { margin: 0; font-family: 'Amiri', serif; background: var(--bg); color: var(--text); overflow: hidden; touch-action: none; }
        
        header { 
            position: fixed; top: -100px; width: 100%; background: var(--primary); 
            padding: 10px 0; transition: 0.3s; z-index: 1000;
            display: flex; justify-content: center; align-items: center; gap: 15px;
        }
        header.active { top: 0; }

        #main-view { height: 100vh; width: 100%; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .page-card { 
            width: 90%; height: 85%; background: white; border: 4px double var(--gold); 
            border-radius: 15px; padding: 20px; overflow-y: auto; transition: transform 0.3s ease-out;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        body.dark .page-card { background: #252525; }

        footer { 
            position: fixed; bottom: -100px; width: 100%; background: var(--primary); 
            display: flex; justify-content: space-around; padding: 15px 0; transition: 0.3s; z-index: 1000;
        }
        footer.active { bottom: 0; }

        .color-dot { width: 28px; height: 28px; border-radius: 50%; border: 2px solid white; cursor: pointer; }
        .btn { color: white; cursor: pointer; font-size: 14px; background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 5px; }
        .word { display: inline-block; padding: 0 2px; border-radius: 4px; transition: background 0.2s; }
    </style>
</head>
<body onclick="toggleInterface()" ontouchstart="handleTouchStart(event)" ontouchend="handleTouchEnd(event)">

    <header id="pen-tools" onclick="event.stopPropagation()">
        <div style="display:flex; gap:10px;">
            <div class="color-dot" style="background:#ffeb3b" onclick="setCol('#ffeb3b')"></div>
            <div class="color-dot" style="background:#ff5252" onclick="setCol('#ff5252')"></div>
            <div class="color-dot" style="background:#64ffda" onclick="setCol('#64ffda')"></div>
        </div>
        <div class="btn" onclick="undo()">‚Ü© ÿ™ÿ±ÿßÿ¨ÿπ</div>
        <div class="btn" onclick="hidePen()" style="color:#ffb3b3">ÿ•ÿ∫ŸÑÿßŸÇ ‚úñ</div>
    </header>

    <div id="main-view">
        <div class="page-card" id="content" onclick="event.stopPropagation()">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</div>
    </div>

    <footer id="main-footer" onclick="event.stopPropagation()">
        <div class="btn" onclick="showPen()">‚úèÔ∏è ÿßŸÑŸÇŸÑŸÖ</div>
        <div id="sura-name" style="color:white; font-weight:bold;"></div>
        <div class="btn" onclick="toggleDark()">üåô ÿßŸÑŸàÿ∂ÿπ</div>
    </footer>

    <script>
        let cur = parseInt(localStorage.getItem('lastSura')) || 0;
        let col = '#ffeb3b';
        let data = [];
        let highlights = JSON.parse(localStorage.getItem('myHighlights')) || [];
        let xDown = null;

        async function load() {
            const res = await fetch('https://api.alquran.cloud/v1/quran/quran-uthmani');
            const d = await res.json();
            data = d.data.surahs;
            render();
        }

        function render() {
            if (!data[cur]) return;
            const s = data[cur];
            document.getElementById('sura-name').innerText = s.name;
            let h = `<h2 style="text-align:center; color:var(--primary)">${s.name}</h2>`;
            s.ayahs.forEach((a, ai) => {
                a.text.split(' ').forEach((w, wi) => {
                    const id = `s${cur}a${ai}w${wi}`;
                    const hl = highlights.find(x => x.id === id);
                    h += `<span id="${id}" class="word" ${hl ? `style="background:${hl.color}"` : ''} onclick="high('${id}','${w}')">${w}</span> `;
                });
                h += `<span style="color:var(--gold)">(${ai+1})</span> `;
            });
            document.getElementById('content').innerHTML = h;
            localStorage.setItem('lastSura', cur);
            document.getElementById('content').scrollTop = 0;
        }

        // --- ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ŸÑŸàŸäŸÜ ŸàÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ (ÿ™ŸÖ ÿßŸÑÿ•ÿµŸÑÿßÿ≠) ---
        function high(id, t) {
            const e = document.getElementById(id);
            if(e.style.background && e.style.background !== 'transparent' && e.style.background !== '') {
                e.style.background = '';
                highlights = highlights.filter(x => x.id !== id);
            } else {
                e.style.background = col;
                highlights.push({id, t, color: col});
            }
            localStorage.setItem('myHighlights', JSON.stringify(highlights));
        }

        function undo() {
            if (highlights.length === 0) return;
            const last = highlights.pop();
            const el = document.getElementById(last.id);
            if (el) {
                el.style.background = ''; // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÑŸàŸÜ ŸÖŸÜ ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÅŸàÿ±ÿßŸã
            }
            localStorage.setItem('myHighlights', JSON.stringify(highlights));
        }

        // --- ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ≥ÿ≠ÿ® ÿßŸÑÿ£ŸÅŸÇŸä (Swipe) ---
        function handleTouchStart(evt) { xDown = evt.touches[0].clientX; }
        function handleTouchEnd(evt) {
            if (!xDown) return;
            let xUp = evt.changedTouches[0].clientX;
            let xDiff = xDown - xUp;
            if (Math.abs(xDiff) > 50) { // ÿ≠ÿ≥ÿßÿ≥Ÿäÿ© ÿßŸÑÿ≥ÿ≠ÿ®
                if (xDiff > 0) next(); else prev();
            }
            xDown = null;
        }

        function toggleInterface() { document.getElementById('main-footer').classList.toggle('active'); }
        function showPen() { document.getElementById('pen-tools').classList.add('active'); }
        function hidePen() { document.getElementById('pen-tools').classList.remove('active'); }
        function setCol(c) { col = c; }
        function next() { if(cur < 113) { cur++; render(); } }
        function prev() { if(cur > 0) { cur--; render(); } }
        function toggleDark() { document.body.classList.toggle('dark'); }

        load();
    </script>
</body>
</html>
